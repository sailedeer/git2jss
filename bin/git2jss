#!/usr/bin/env ruby
#require 'git2jss' # => this is the gem itself
require 'optparse'

cli_options = Struct.new(:name)

class CLIParser
  attr_reader :files, :all, :names, :source_dir, :ref, :info, :verbose

  def initialize
    self.files = []
    self.all = false
    self.names = []
    self.source_dir = nil
    self.ref = nil
    self.info = nil
    self.verbose = false
  end

  def define_options(parser)
    parser.banner = "Usage: git2jss [options]"
    parser.separator ""
    parser.separator "Specific options:"

    files_option(parser)
    all_option(parser)
    names_option(parser)
    source_dir_option(parser)
    branch_option
end

# collect command line arguments
options = {}
option_parser = OptionParser.new do |opts|
  opts.banner = "Usage: git2jss [options]"

  opts.on("-h", "--help", "Display this screen") do 
    
    exit
  end

  options[:file] = nil
  opts.on("-f", "--file FILE", "File to upload to the JSS") do |f|
    options[:file] = f
  end

  options[:branch] = nil
  opts.on("-b",
          "--branch BRANCH",
          "Branch to look for the file in") do |b|
    options[:branch] = b
  end

  options[:tag] = nil
  opts.on("-t",
    "--tag TAG",
    "Tag to look for the file at") do |t|
    options[:tag] = t
  end

  options[:name] = nil
  opts.on("-n",
          "--name NAME",
          "Name of the Script object in the JSS") do |n|
    options[:name] = n
  end

  options[:all] = false
  opts.on("-a",
          "--all",
          "Grab all files in the ref?") do
    options[:all] = true
  end

  options[:verbose] = false
  opts.on("-v",
          "--verbose",
          "Be verbose with our output") do
    options[:verbose] = true
  end

  options[:info] = false
  opts.on("-i",
          "--jss-info",
          "Print configure JSS options") do
    options[:info] = true
  end
end

option_parser.parse

puts ARGV.length

# construct prefs object based on specified args

# construct repo object based on specified args

# for all files specified (some subset of all files in ref or all)

  # check if the file exists

  # attempt to put it on the jss

  # get some information about the specified ref (commit or tag)

  # update notes with that information (commit/tag message, commit/tag name/id)
